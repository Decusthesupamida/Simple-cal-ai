package net.ppronko.pet.ai_calories_parser.bot_command

import net.ppronko.pet.ai_calories_parser.data.BotCommandConstants
import net.ppronko.pet.ai_calories_parser.pattern.Command
import net.ppronko.pet.ai_calories_parser.util.MarkdownV2Escaper
import org.springframework.stereotype.Component
import org.telegram.telegrambots.meta.api.methods.send.SendMessage
import org.telegram.telegrambots.meta.api.objects.Update
import org.telegram.telegrambots.meta.bots.AbsSender

@Component
class HelpCommand : Command {

    override fun getCommandName(): String = BotCommandConstants.HELP.command

    override fun execute(update: Update, sender: AbsSender) {
        val chatId = update.message.chatId

        val helpText = """
            *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Simple cal ai* ü§ñ
            
            –Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ –ª–µ–≥–∫–æ –∏ –±—ã—Å—Ç—Ä–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–∞–ª–æ—Ä–∏–∏ –∏ –ë–ñ–£, –∏—Å–ø–æ–ª—å–∑—É—è –º–æ—â—å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞\.
            
            *–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:*
            
            *1\. üçΩÔ∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –µ–¥—ã*
            –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É *"–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å üçΩÔ∏è"* –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å –∫–æ–º–∞–Ω–¥—É `/add`\. –¢—ã –º–æ–∂–µ—à—å:
            - *–û–ø–∏—Å–∞—Ç—å –µ–¥—É —Ç–µ–∫—Å—Ç–æ–º:* –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏, —á—Ç–æ —Ç—ã —Å—ä–µ–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä: `–æ–≤—Å—è–Ω–∫–∞ –Ω–∞ –º–æ–ª–æ–∫–µ —Å –±–∞–Ω–∞–Ω–æ–º`\. –Ø —Å–∞–º –≤—Å–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –∏ —Ä–∞—Å—Å—á–∏—Ç–∞—é\.
            - *–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ:* –ü—Ä–∏–∫—Ä–µ–ø–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é —Å–≤–æ–µ–≥–æ –±–ª—é–¥–∞, –∏ —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –µ–≥–æ —Å–æ—Å—Ç–∞–≤\. –¢—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ñ–æ—Ç–æ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è\.
            
            *2\. üìà –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–¥–∫–∏*
            –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É *"–°–≤–æ–¥–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è üìà"* –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å –∫–æ–º–∞–Ω–¥—É `/summary`, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –ö–ë–ñ–£ –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å, –∞ —Ç–∞–∫–∂–µ —Å–∫–æ–ª—å–∫–æ –µ—â–µ –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ —Ç–≤–æ–µ–π —Ü–µ–ª–∏\.
            
            *3\. üë§ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º*
            –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É *"–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å üë§"* –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å –∫–æ–º–∞–Ω–¥—É `/profile`\. –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ —Ç—ã –º–æ–∂–µ—à—å:
            - –£–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã \(–ø–æ–ª, –≤–æ–∑—Ä–∞—Å—Ç, –≤–µ—Å, —Ä–æ—Å—Ç\)\.
            - –û–ø–∏—Å–∞—Ç—å —Å–≤–æ—é —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —á—Ç–æ–±—ã —è —Ä–∞—Å—Å—á–∏—Ç–∞–ª –¥–ª—è —Ç–µ–±—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç\.
            - –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É *–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º* —Ä–∞—Å—á–µ—Ç–æ–º —Ü–µ–ª–µ–π \(–Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è\) –∏ *—Ä—É—á–Ω–æ–π* —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π\.
            
            *4\. üÜò –ü–æ–º–æ—â—å*
            –ö–æ–º–∞–Ω–¥–∞ `/help` –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ *"–ü–æ–º–æ—â—å ‚ÑπÔ∏è"* –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∂—É—Ç —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ\.
            
            –ñ–µ–ª–∞—é —É—Å–ø–µ—Ö–æ–≤ –≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ç–≤–æ–∏—Ö —Ü–µ–ª–µ–π\! ‚ú®
        """.trimIndent()

        // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ —Å MarkdownV2
        val escapedText = MarkdownV2Escaper.escape(helpText)

        // –ê —Ç–µ–ø–µ—Ä—å "–≤–æ–∑–≤—Ä–∞—â–∞–µ–º" —Å–∏–º–≤–æ–ª—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–º –Ω—É–∂–Ω—ã
        val final_text = escapedText
            .replace("\\*", "*") // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç
            .replace("\\`", "`") // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç

        sender.execute(SendMessage(chatId.toString(), final_text).apply {
            parseMode = "Markdown"
        })
    }
}