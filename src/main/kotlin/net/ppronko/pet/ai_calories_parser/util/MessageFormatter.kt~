package net.ppronko.pet.ai_calories_parser.util
import net.ppronko.pet.ai_calories_parser.data.DailySummaryDto

object MessageFormatter {

    fun formatSummary(summary: DailySummaryDto): String {
        if (summary.entries.isEmpty()) {
            return "Ğ—Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ ĞµÑ‰Ğµ Ğ½ĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ² Ğ´Ğ½ĞµĞ²Ğ½Ğ¸ĞºĞµ."
        }

        val eatenHeader = "<b>Ğ¡ÑŠĞµĞ´ĞµĞ½Ğ¾:</b>"
        val entriesList = summary.entries.joinToString("\n") {
            "- ${escapeHtml(it.mealName)}: ${it.totalCalories} ĞºĞºĞ°Ğ»"
        }

        val c = summary.consumed
        val g = summary.goal
        val r = summary.remaining

        val table = """
                <pre>
                 Ğ¡ÑŠĞµĞ´ĞµĞ½Ğ¾ /  Ğ¦ĞµĞ»ÑŒ / ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ
                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                ğŸ”¥ ĞšĞºĞ°Ğ»:     ${c.calories.toString().padStart(5)} / ${
                            g.calories.toString().padStart(5)
                        } / ${r.calories.toString().padStart(5)}
                ğŸ’ª Ğ‘ĞµĞ»ĞºĞ¸:    ${c.protein.toString().padStart(5)} / ${
                            g.protein.toString().padStart(5)
                        } / ${r.protein.toString().padStart(5)}
                ğŸ¥‘ Ğ–Ğ¸Ñ€Ñ‹:     ${c.fats.toString().padStart(5)} / ${
                            g.fats.toString().padStart(5)
                        } / ${r.fats.toString().padStart(5)}
                ğŸ Ğ£Ğ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹: ${c.carbs.toString().padStart(5)} / ${
                            g.carbs.toString().padStart(5)
                        } / ${r.carbs.toString().padStart(5)}
                </pre>
        """.trimIndent()

        return """
ğŸ“ˆ <b>Ğ¡Ğ²Ğ¾Ğ´ĞºĞ° Ğ·Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ</b>   
            
$eatenHeader
$entriesList
            
ğŸ“Š <b>ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ</b>
            $table
        """.trimIndent()
    }

    private fun escapeHtml(text: String): String =
        text.replace("&", "&amp;")
            .replace("<", "&lt;")
            .replace(">", "&gt;")
}